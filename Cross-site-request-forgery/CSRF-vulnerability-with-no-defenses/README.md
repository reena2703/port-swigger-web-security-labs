# CSRF – Vulnerability With No Defenses

(**Web Security Academy**)

This lab demonstrates a **basic but critical Cross-Site Request Forgery (CSRF)** vulnerability where the application implements **no CSRF defenses whatsoever**. The attack is successfully exploited using **Burp Suite Community Edition only**.

---

## Lab: CSRF Vulnerability With No Defenses

**Category:** Cross-Site Request Forgery (CSRF)
**Protection Level:** None
**Difficulty:** Apprentice
**Tools Used:** Burp Suite Community Edition
**Status:** Solved

---

## What This Lab Is About

The application’s **email change functionality** does not include:

* CSRF tokens
* Origin or Referer validation
* SameSite cookie protection

This allows an attacker to **forge authenticated requests** from a malicious page and change a victim’s email address without their consent.

---

## Target Functionality

Vulnerable endpoint:

```
POST /my-account/change-email
```

Parameters:

* `email`

There is **no CSRF token**, making the endpoint fully exploitable.

---

## Vulnerable Flow

1. Victim logs in to the application
2. Victim visits an attacker-controlled page
3. Browser automatically includes session cookies
4. Forged request is sent
5. Server processes the request without validation
6. Victim’s email is changed

---

## CSRF Exploit Payload (Manual – Community Edition)

Since **Burp Suite Community Edition** does not support automatic CSRF PoC generation, the exploit was created **manually**.

```html
<form method="POST" action="https://YOUR-LAB-ID.web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="anything@web-security-academy.net">
</form>

<script>
    document.forms[0].submit();
</script>
```

### Why This Works

* Browsers automatically attach cookies to requests
* The application trusts all authenticated requests
* No CSRF token is checked
* No request origin validation exists

---

## Steps I Followed (Community Edition)

1. Logged in using the provided credentials:

   ```
   wiener:peter
   ```

2. Changed the email address normally

3. Captured the request in **Burp Proxy → HTTP history**

4. Observed the request contained:

   * No CSRF token

5. Right-clicked the request and selected **Copy URL**

6. Manually created a CSRF HTML form using the captured endpoint

7. Hosted the exploit on the **exploit server**

8. Clicked **View exploit** to test it on myself

9. Changed the email value to avoid matching my own

10. Clicked **Deliver exploit to victim**

11. Victim’s email was changed automatically

12. Lab marked as solved

---

## Why This Worked

* No CSRF token enforcement
* No SameSite cookie restrictions
* No origin or referer checks
* Browser automatically authenticated the request

This is a **textbook CSRF vulnerability**.

---

## Impact

An attacker can:

* Change account details
* Perform unauthorized actions
* Abuse authenticated user sessions
* Potentially escalate to full account compromise

Severity: **High**

---

## Key Lessons Learned

* CSRF attacks do not require JavaScript
* Burp Suite Community Edition is sufficient
* Authentication ≠ Authorization
* Browsers are trusted too much by default
* CSRF protection must be universal

---

## Defensive Takeaways

To prevent this vulnerability:

* Implement CSRF tokens for all state-changing requests
* Enforce SameSite cookies (`Lax` or `Strict`)
* Validate Origin and Referer headers
* Restrict sensitive actions to POST requests
* Use layered defenses

---

## Final Summary

* No CSRF protections implemented
* Manual HTML form used for exploitation
* Attack executed using Burp Suite Community Edition
* Victim’s email changed without consent
* Demonstrates baseline CSRF risk
 
